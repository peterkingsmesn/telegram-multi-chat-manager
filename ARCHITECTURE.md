# í…”ë ˆê·¸ë¨ ë©€í‹° ì±— ë§¤ë‹ˆì € - ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

## ğŸ—ï¸ ì „ì²´ ì‹œìŠ¤í…œ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ì›¹ ë¸Œë¼ìš°ì € (í´ë¼ì´ì–¸íŠ¸)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ login.html  â”‚  â”‚ index.html   â”‚  â”‚ api_register.html  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚         â”‚                 â”‚                    â”‚                  â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                           â”‚                                       â”‚
â”‚                      app.js + config_client.js                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ HTTP/HTTPS
                            â”‚ (Credentials: include)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ë°±ì—”ë“œ ì„œë²„ ë ˆì´ì–´                          â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ telegram_server.py â”‚  â”‚ proxy_server.py â”‚  â”‚license_serverâ”‚ â”‚
â”‚  â”‚    (í¬íŠ¸ 5000)     â”‚  â”‚   (í¬íŠ¸ 5002)   â”‚  â”‚  (í¬íŠ¸ 5001) â”‚ â”‚
â”‚  â”‚                    â”‚  â”‚                 â”‚  â”‚              â”‚ â”‚
â”‚  â”‚ - API ë“±ë¡         â”‚  â”‚ - ë©”ì‹œì§€ ì „ì†¡   â”‚  â”‚ - ë¼ì´ì„¼ìŠ¤   â”‚ â”‚
â”‚  â”‚ - ì„¸ì…˜ ê´€ë¦¬        â”‚  â”‚ - ê·¸ë£¹ ê´€ë¦¬     â”‚  â”‚ - ì¸ì¦ ê²€ì¦  â”‚ â”‚
â”‚  â”‚ - ê³„ì • ê´€ë¦¬        â”‚  â”‚ - í”„ë¡ì‹œ ì„¤ì •   â”‚  â”‚ - ì‚¬ìš© ë¡œê·¸  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚           â”‚                        â”‚                   â”‚         â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                    â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â”‚ Telethon API
                                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         í…”ë ˆê·¸ë¨ ì„œë²„                              â”‚
â”‚                                                                  â”‚
â”‚  - SMS ì¸ì¦                                                      â”‚
â”‚  - 2ì°¨ ë¹„ë°€ë²ˆí˜¸ ì¸ì¦                                              â”‚
â”‚  - ë©”ì‹œì§€ ì „ì†¡                                                    â”‚
â”‚  - ê·¸ë£¹ ê´€ë¦¬                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ í•µì‹¬ ì»´í¬ë„ŒíŠ¸

### 1. í”„ë¡ íŠ¸ì—”ë“œ (Web Client)

#### êµ¬ì„± ìš”ì†Œ
- **HTML í˜ì´ì§€**: ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤
- **app.js**: ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œì§
- **config_client.js**: í´ë¼ì´ì–¸íŠ¸ ì„¤ì • ê´€ë¦¬

#### ì£¼ìš” ê¸°ëŠ¥
```javascript
// API ìš”ì²­ í†µí•© ê´€ë¦¬
async function apiRequest(url, options = {}) {
    // ì¸ì¦ í—¤ë” ìë™ ì¶”ê°€
    // ì—ëŸ¬ ì²˜ë¦¬ ë° ë¦¬ë‹¤ì´ë ‰íŠ¸
    // ì„¸ì…˜ ê´€ë¦¬
}

// ìƒíƒœ ê´€ë¦¬
const appState = {
    apis: [],           // ë“±ë¡ëœ API ëª©ë¡
    rooms: {},          // ê·¸ë£¹/ì±„ë„ ì •ë³´
    currentPhone: null  // í˜„ì¬ í™œì„± ê³„ì •
}
```

### 2. ë°±ì—”ë“œ ì„œë²„

#### telegram_server.py (ë©”ì¸ ì„œë²„)
```python
# Flask ì•± êµ¬ì¡°
app = create_app()
app.register_blueprint(api_register_bp)  # API ë“±ë¡
app.register_blueprint(auth_bp)         # ì¸ì¦

# í•µì‹¬ ë°ì½”ë ˆì´í„°
@login_required  # ë¡œê·¸ì¸ í•„ìˆ˜
@error_handler   # ì—ëŸ¬ ì²˜ë¦¬
@validate_phone_required  # ì „í™”ë²ˆí˜¸ ê²€ì¦
```

#### proxy_server.py (ë³´ì¡° ì„œë²„)
```python
# ê°„ì†Œí™”ëœ API ì„œë¹„ìŠ¤
# ì£¼ë¡œ ë©”ì‹œì§€ ì „ì†¡ê³¼ ê·¸ë£¹ ê´€ë¦¬ ë‹´ë‹¹
# telegram_server.pyì™€ ë™ì¼í•œ ì¸ì¦ ì²´ê³„ ì‚¬ìš©
```

### 3. ë¼ì´ì„¼ìŠ¤ ì„œë²„

#### ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ
```sql
-- ë¼ì´ì„¼ìŠ¤ í…Œì´ë¸”
CREATE TABLE licenses (
    license_key TEXT PRIMARY KEY,
    user_id TEXT,
    email TEXT,
    license_type TEXT,
    max_accounts INTEGER,
    hardware_id TEXT,
    expires_at TIMESTAMP,
    is_active BOOLEAN,
    memo TEXT
);

-- ì‚¬ìš© ë¡œê·¸ í…Œì´ë¸”
CREATE TABLE usage_logs (
    id INTEGER PRIMARY KEY,
    license_key TEXT,
    hardware_id TEXT,
    ip_address TEXT,
    action TEXT,
    timestamp TIMESTAMP,
    success BOOLEAN
);
```

## ğŸ”’ ë³´ì•ˆ ì•„í‚¤í…ì²˜

### 1. ì¸ì¦ íë¦„
```
ì‚¬ìš©ì â†’ ë¼ì´ì„¼ìŠ¤ í‚¤ ì…ë ¥ â†’ í•˜ë“œì›¨ì–´ ID ìƒì„± 
    â†“
ë¼ì´ì„¼ìŠ¤ ì„œë²„ ê²€ì¦
    â†“
Flask ì„¸ì…˜ ìƒì„± (24ì‹œê°„)
    â†“
ëª¨ë“  API ìš”ì²­ì— ì„¸ì…˜ ê²€ì¦
```

### 2. ë³´ì•ˆ ë ˆì´ì–´
- **í”„ë¡ íŠ¸ì—”ë“œ**: CORS, ìë™ ë¡œê·¸ì•„ì›ƒ
- **ë°±ì—”ë“œ**: ë°ì½”ë ˆì´í„° ê¸°ë°˜ ì ‘ê·¼ ì œì–´
- **ë¼ì´ì„¼ìŠ¤**: í•˜ë“œì›¨ì–´ ë°”ì¸ë”©, IP ë¡œê¹…
- **í…”ë ˆê·¸ë¨**: 2FA ì§€ì›, ì„¸ì…˜ ì•”í˜¸í™”

## ğŸ“Š ë°ì´í„° íë¦„

### 1. API ë“±ë¡ í”„ë¡œì„¸ìŠ¤
```mermaid
stateDiagram-v2
    [*] --> ì „í™”ë²ˆí˜¸ì…ë ¥
    ì „í™”ë²ˆí˜¸ì…ë ¥ --> APIí‚¤ì…ë ¥
    APIí‚¤ì…ë ¥ --> ì—°ê²°ì‹œë„
    ì—°ê²°ì‹œë„ --> SMSëŒ€ê¸°
    SMSëŒ€ê¸° --> ì½”ë“œì…ë ¥
    ì½”ë“œì…ë ¥ --> ì¸ì¦í™•ì¸
    
    ì¸ì¦í™•ì¸ --> 2ì°¨ì¸ì¦: í•„ìš”ì‹œ
    2ì°¨ì¸ì¦ --> ë¹„ë°€ë²ˆí˜¸ì…ë ¥
    ë¹„ë°€ë²ˆí˜¸ì…ë ¥ --> ì¸ì¦í™•ì¸
    
    ì¸ì¦í™•ì¸ --> ë“±ë¡ì™„ë£Œ
    ë“±ë¡ì™„ë£Œ --> [*]
```

### 2. ë©”ì‹œì§€ ì „ì†¡ í”„ë¡œì„¸ìŠ¤
```mermaid
graph LR
    A[ë©”ì‹œì§€ ì‘ì„±] --> B[ê·¸ë£¹ ì„ íƒ]
    B --> C[ì „ì†¡ ìš”ì²­]
    C --> D{ì„¸ì…˜ ê²€ì¦}
    D -->|ìœ íš¨| E[í…”ë ˆê·¸ë¨ API í˜¸ì¶œ]
    D -->|ë¬´íš¨| F[ë¡œê·¸ì¸ í˜ì´ì§€]
    E --> G[ì „ì†¡ ê²°ê³¼]
    G --> H[UI ì—…ë°ì´íŠ¸]
```

## ğŸ—‚ï¸ íŒŒì¼ êµ¬ì¡° ë° ì—­í• 

### í•µì‹¬ ëª¨ë“ˆ
```
utils.py
â”œâ”€â”€ ConfigManager      # ì„¤ì • ê´€ë¦¬
â”œâ”€â”€ SessionManager     # ì„¸ì…˜ íŒŒì¼ ê´€ë¦¬
â”œâ”€â”€ handle_telegram_error  # ì—ëŸ¬ ì²˜ë¦¬
â””â”€â”€ create_telegram_client # í´ë¼ì´ì–¸íŠ¸ ìƒì„±

decorators.py
â”œâ”€â”€ @login_required    # ë¡œê·¸ì¸ ê²€ì¦
â”œâ”€â”€ @error_handler     # ì—ëŸ¬ ì²˜ë¦¬
â””â”€â”€ @validate_phone_required  # ì „í™”ë²ˆí˜¸ ê²€ì¦

app_factory.py
â”œâ”€â”€ create_app()       # Flask ì•± ìƒì„±
â””â”€â”€ register_blueprints()  # ë¸”ë£¨í”„ë¦°íŠ¸ ë“±ë¡
```

### ì„¤ì • íŒŒì¼
```
config.json
â”œâ”€â”€ server             # ì„œë²„ ì„¤ì •
â”œâ”€â”€ telegram           # í…”ë ˆê·¸ë¨ API ì„¤ì •
â””â”€â”€ proxies           # í”„ë¡ì‹œ ì„¤ì •

account_config.json
â”œâ”€â”€ predefined_accounts  # ì‚¬ì „ ì •ì˜ ê³„ì •
â””â”€â”€ critical_accounts    # ì¤‘ìš” ê³„ì • ëª©ë¡
```

## ğŸš¦ ìƒíƒœ ê´€ë¦¬

### í´ë¼ì´ì–¸íŠ¸ ìƒíƒœ
```javascript
// ì „ì—­ ìƒíƒœ (app.js)
const appState = {
    // ê³„ì • ê´€ë¦¬
    apis: [],
    activeFirepower: 1,
    activeExpert: null,
    
    // ê·¸ë£¹/ì±„ë„ ê´€ë¦¬
    rooms: {
        expert: [],
        firepower: {}
    },
    
    // ì„¸ì…˜ ì •ë³´
    currentPhone: null,
    currentUser: null
}
```

### ì„œë²„ ìƒíƒœ
```python
# ì „ì—­ í´ë¼ì´ì–¸íŠ¸ ê´€ë¦¬
clients = {}  # í™œì„± í…”ë ˆê·¸ë¨ í´ë¼ì´ì–¸íŠ¸
phone_code_hashes = {}  # SMS ì¸ì¦ í•´ì‹œ

# ì„ì‹œ ë“±ë¡ ìƒíƒœ
temp_clients = {}  # ë“±ë¡ ì¤‘ì¸ í´ë¼ì´ì–¸íŠ¸
temp_code_hashes = {}  # ë“±ë¡ ì¤‘ì¸ ì¸ì¦ í•´ì‹œ
```

## ğŸ“ˆ ì„±ëŠ¥ ìµœì í™”

### 1. ì—°ê²° í’€ë§
- í…”ë ˆê·¸ë¨ í´ë¼ì´ì–¸íŠ¸ ì¬ì‚¬ìš©
- ì„¸ì…˜ íŒŒì¼ ìºì‹±
- í”„ë¡ì‹œ ì—°ê²° ìœ ì§€

### 2. ë¹„ë™ê¸° ì²˜ë¦¬
- asyncio ê¸°ë°˜ ë™ì‹œì„±
- nest_asyncioë¡œ ì¤‘ì²© ì‹¤í–‰
- ë°°ì¹˜ ë©”ì‹œì§€ ì „ì†¡

### 3. ë¦¬ì†ŒìŠ¤ ê´€ë¦¬
- ìë™ ì„¸ì…˜ ì •ë¦¬
- ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§
- ì—°ê²° íƒ€ì„ì•„ì›ƒ ì„¤ì •

## ğŸ” ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹…

### ë¡œê¹… ì‹œìŠ¤í…œ
```python
# utils.pyì˜ setup_logging()
logger = setup_logging()
logger.info("ì‘ì—… ì„±ê³µ")
logger.error("ì˜¤ë¥˜ ë°œìƒ", exc_info=True)
logger.warning("ê²½ê³  ë©”ì‹œì§€")
```

### ëª¨ë‹ˆí„°ë§ í¬ì¸íŠ¸
- API í˜¸ì¶œ íšŸìˆ˜ ë° ì„±ê³µë¥ 
- ì„¸ì…˜ ìƒíƒœ ë° ë§Œë£Œ ì‹œê°„
- ë¼ì´ì„¼ìŠ¤ ì‚¬ìš© í˜„í™©
- í…”ë ˆê·¸ë¨ API ì œí•œ ìƒíƒœ

## ğŸ›¡ï¸ ì—ëŸ¬ ì²˜ë¦¬ ì „ëµ

### 1. í´ë¼ì´ì–¸íŠ¸ ì—ëŸ¬ ì²˜ë¦¬
```javascript
// í†µí•© ì—ëŸ¬ ì²˜ë¦¬ (apiRequest)
if (response.status === 401) {
    window.location.href = 'login.html';
}
```

### 2. ì„œë²„ ì—ëŸ¬ ì²˜ë¦¬
```python
# ê³„ì¸µì  ì—ëŸ¬ ì²˜ë¦¬
@error_handler  # ì „ì—­ ì—ëŸ¬ ìºì¹˜
@async_error_handler  # ë¹„ë™ê¸° ì—ëŸ¬ ì²˜ë¦¬
handle_telegram_error()  # í…”ë ˆê·¸ë¨ íŠ¹í™” ì²˜ë¦¬
```

### 3. ë³µêµ¬ ì „ëµ
- ìë™ ì¬ì—°ê²°
- ì„¸ì…˜ ë°±ì—… ë° ë³µêµ¬
- ëŒ€ì²´ í”„ë¡ì‹œ ì „í™˜
- ì‚¬ìš©ì ì•Œë¦¼ ì‹œìŠ¤í…œ